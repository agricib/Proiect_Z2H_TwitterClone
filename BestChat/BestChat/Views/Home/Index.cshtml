@{
    ViewBag.Title = "Home Page";
}


<div id="map" style="height: 450px;width: 800px;margin:100px auto"></div>
<script>
    var map;
    function addMarker(user) {
        console.log('Data recived');
        var marker = L.marker([user.Latitude,user.Longitude], { draggable: true });
        marker.addTo(map).bindPopup(user.UserName).openPopup();;
        map.setView([user.Latitude, user.Longitude]);
    }

    $(document).ready(function () {
        map = L.map('map').setView([44.5, 26], 10);
        var layer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png');
        layer.addTo(map);
      
        
        
    });
    $(document).ready(function () {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(SendPosition);
        }
        else {
            alert( "Geolocation is not supported by this browser.");
        }
        function SendPosition(position) {
           // addMarker(position.coords.latitude, position.coords.longitude);
         
            $.post("/api/UserPosition", { Latitude: position.coords.latitude, Longitude: position.coords.longitude })
            .done(function (data) {               
            });
           
        }

    });
</script>

<div id="onlineUsers">
    
</div>
<script>
    var showusers = function (users) {
        $('#onlineUsers').empty();
        var div = $('#onlineUsers');
        users.forEach(function (user) {
            console.log(user);         
            addMarker(user);
            div.append($('<p>' + user.UserName + '</p>'));
        });

    };
    var onlineusers=[];
    $.get("/api/User").done(function (users) {
        onlineusers = users;
        showusers(users);

    });
    $("#buton-SearchUser").on("click", function () {
        var username = $("#input-SearchUser").val();
        var findedusers = [];
        onlineusers.forEach(function (user) {
            if (user.UserName.indexOf(username) > -1) {
                findedusers.push(user);
            }

        });
        showusers(findedusers);
    });
</script>